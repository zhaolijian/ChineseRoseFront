"use strict";var e=Object.defineProperty,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(o,t,r)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,n=(e,o,t)=>new Promise((r,l)=>{var n=e=>{try{a(t.next(e))}catch(o){l(o)}},i=e=>{try{a(t.throw(e))}catch(o){l(o)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,i);a((t=t.apply(e,o)).next())});const i=require("../../common/vendor.js"),a=require("../../stores/modules/book.js"),s=require("../../stores/modules/note.js"),u=require("../../stores/modules/mindmap.js");if(require("../../utils/request.js"),require("../../utils/logger.js"),require("../../utils/logger-helpers.js"),require("../../stores/modules/user.js"),require("../../utils/storage.js"),require("../../constants/storage.js"),require("../../utils/base64.js"),require("../../api/modules/auth.js"),require("../../types/errorCodes.js"),require("../../constants/request.js"),require("../../utils/error-handler.js"),require("../../api/modules/note.js"),require("../../api/modules/mindmap.js"),!Array){(i.resolveComponent("u-button")+i.resolveComponent("u-input")+i.resolveComponent("u-form-item")+i.resolveComponent("u-textarea")+i.resolveComponent("u-form")+i.resolveComponent("u-icon")+i.resolveComponent("u-popup")+i.resolveComponent("u-loading-page"))()}Math||(c+p+d)();const c=()=>"../../components/common/AppNavBar.js",d=()=>"../../components/common/PageContainer.js",p=()=>"../../components/common/EmptyState.js",v=i.defineComponent({__name:"create",setup(e){const c=a.useBookStore();s.useNoteStore(),u.useMindmapStore();const d=i.ref(!1),p=i.ref(!1),v=i.ref(!1),m=i.ref("blank"),b=i.ref([]),h=i.ref([]),f=i.ref([]),g=i.ref(null),k=i.reactive({title:"",bookId:null,description:""}),y={title:[{required:!0,message:"请输入思维导图标题",trigger:"blur"}],bookId:[{required:!0,message:"请选择书籍",trigger:"change"}]},j=i.computed(()=>"blank"===m.value?k.title.trim()&&k.bookId:k.title.trim()&&k.bookId&&f.value.length>0);i.onMounted(()=>n(this,null,function*(){yield q()}));const q=()=>n(this,null,function*(){try{d.value=!0;const e=yield c.fetchBooks(1);b.value=e.books||[]}catch(e){console.error("加载数据失败:",e),i.index.showToast({title:"加载数据失败",icon:"error"})}finally{d.value=!1}}),x=e=>{m.value=e,"notes"===e&&k.bookId&&w()},I=e=>n(this,null,function*(){g.value=e,k.bookId=e.id,v.value=!1,"notes"===m.value&&(yield w())}),w=()=>n(this,null,function*(){if(k.bookId)try{h.value=[{id:1,title:"第一章重点",content:"这是第一章的重点内容摘录...",bookId:k.bookId,createdAt:"2024-01-15T10:30:00Z"}]}catch(e){console.error("加载笔记失败:",e)}}),C=()=>n(this,null,function*(){if(j.value)try{p.value=!0;const e=((e,n)=>{for(var i in n||(n={}))t.call(n,i)&&l(e,i,n[i]);if(o)for(var i of o(n))r.call(n,i)&&l(e,i,n[i]);return e})({title:k.title.trim(),bookId:k.bookId,description:k.description.trim()||void 0,type:m.value},"notes"===m.value&&{sourceNoteIds:f.value});console.debug("[createMindmap] 待提交数据",e),i.index.showToast({title:"创建成功",icon:"success"}),setTimeout(()=>{i.index.navigateBack()},1500)}catch(e){console.error("创建思维导图失败:",e),i.index.showToast({title:"创建失败",icon:"error"})}finally{p.value=!1}else i.index.showToast({title:"请填写完整信息",icon:"error"})}),T=()=>{k.bookId?i.index.navigateTo({url:`/pages-note/add/add?bookId=${k.bookId}`}):i.index.showToast({title:"请先选择书籍",icon:"none"})},z=()=>{v.value=!1,i.index.navigateTo({url:"/pages/index/index"})};return(e,o)=>i.e({a:i.o(C),b:i.p({text:"保存",size:"mini",type:"primary",loading:p.value}),c:i.p({title:"创建思维导图",showBack:!0}),d:i.o(e=>k.title=e),e:i.p({placeholder:"请输入思维导图标题",border:!1,modelValue:k.title}),f:i.p({label:"思维导图标题",prop:"title",required:!0}),g:i.o(e=>v.value=!0),h:i.p({text:g.value?g.value.title:"请选择书籍",size:"large",type:g.value?"info":"default",plain:!0}),i:i.p({label:"选择书籍",prop:"bookId",required:!0}),j:i.o(e=>k.description=e),k:i.p({placeholder:"请输入备注信息（可选）",height:"80",border:!1,modelValue:k.description}),l:i.p({label:"备注",prop:"description"}),m:i.sr("formRef","340aa05c-3,340aa05c-2"),n:i.p({model:k,rules:y}),o:i.p({name:"file",size:"32",color:"blank"===m.value?"#059669":"#666"}),p:"blank"===m.value?1:"",q:i.o(e=>x("blank")),r:i.p({name:"list",size:"32",color:"notes"===m.value?"#059669":"#666"}),s:"notes"===m.value?1:"",t:i.o(e=>x("notes")),v:"notes"===m.value},"notes"===m.value?i.e({w:0===h.value.length},0===h.value.length?{x:i.o(T),y:i.p({icon:"list",title:"该书籍暂无笔记",actionText:"去添加笔记"})}:{z:i.f(h.value,(e,o,t)=>{return{a:"340aa05c-13-"+t+",340aa05c-2",b:i.p({name:f.value.includes(e.id)?"checkbox-mark":"checkbox",size:"20",color:f.value.includes(e.id)?"#059669":"#ccc"}),c:i.t(e.title||"无标题"),d:i.t(e.content),e:i.t((r=e.createdAt,new Date(r).toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"}))),f:e.id,g:f.value.includes(e.id)?1:"",h:i.o(o=>(e=>{const o=f.value.indexOf(e);o>-1?f.value.splice(o,1):f.value.push(e)})(e.id),e.id)};var r})}):{},{A:0===b.value.length},0===b.value.length?{B:i.o(z),C:i.p({icon:"book",title:"暂无书籍",actionText:"去添加书籍"})}:{D:i.f(b.value,(e,o,t)=>({a:i.t(e.title),b:i.t(e.author||"未知作者"),c:e.id,d:i.o(o=>I(e),e.id)}))},{E:i.o(e=>v.value=e),F:i.p({mode:"bottom",height:"60%",round:"20",closeable:!0,modelValue:v.value}),G:i.p({loading:d.value,"bg-color":"#f5f7fa"})})}}),m=i._export_sfc(v,[["__scopeId","data-v-340aa05c"]]);wx.createPage(m);
