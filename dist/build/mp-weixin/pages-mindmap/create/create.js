"use strict";var e=Object.defineProperty,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(o,t,n)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,l=(e,o,t)=>new Promise((n,r)=>{var l=e=>{try{s(t.next(e))}catch(o){r(o)}},u=e=>{try{s(t.throw(e))}catch(o){r(o)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,u);s((t=t.apply(e,o)).next())});const u=require("../../common/vendor.js"),s=require("../../stores/modules/book.js"),i=require("../../stores/modules/note.js"),a=require("../../stores/modules/mindmap.js");if(require("../../utils/request.js"),require("../../utils/logger.js"),require("../../utils/logger-helpers.js"),require("../../stores/modules/user.js"),require("../../utils/storage.js"),require("../../constants/storage.js"),require("../../utils/base64.js"),require("../../api/modules/auth.js"),require("../../types/errorCodes.js"),require("../../constants/request.js"),require("../../utils/error-handler.js"),require("../../api/modules/note.js"),require("../../api/modules/mindmap.js"),!Array){(u.resolveComponent("u-button")+u.resolveComponent("u-input")+u.resolveComponent("u-form-item")+u.resolveComponent("u-textarea")+u.resolveComponent("u-form")+u.resolveComponent("u-icon")+u.resolveComponent("u-popup")+u.resolveComponent("u-loading-page"))()}Math||((()=>"../../node-modules/uview-plus/components/u-button/u-button.js")+d+(()=>"../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../node-modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../../node-modules/uview-plus/components/u-textarea/u-textarea.js")+(()=>"../../node-modules/uview-plus/components/u-form/u-form.js")+(()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+p+c+(()=>"../../node-modules/uview-plus/components/u-popup/u-popup.js")+(()=>"../../node-modules/uview-plus/components/u-loading-page/u-loading-page.js"))();const d=()=>"../../components/common/AppNavBar.js",c=()=>"../../components/common/PageContainer.js",p=()=>"../../components/common/EmptyState.js",m=u.defineComponent({__name:"create",setup(e){const d=s.useBookStore();i.useNoteStore(),a.useMindmapStore();const c=u.ref(!1),p=u.ref(!1),m=u.ref(!1),v=u.ref("blank"),b=u.ref([]),f=u.ref([]),h=u.ref([]),g=u.ref(null),j=u.reactive({title:"",bookId:null,description:""}),k={title:[{required:!0,message:"请输入思维导图标题",trigger:"blur"}],bookId:[{required:!0,message:"请选择书籍",trigger:"change"}]},y=u.computed(()=>"blank"===v.value?j.title.trim()&&j.bookId:j.title.trim()&&j.bookId&&h.value.length>0);u.onMounted(()=>l(this,null,function*(){yield x()}));const x=()=>l(this,null,function*(){try{c.value=!0;const e=yield d.fetchBooks(1);b.value=e.books||[]}catch(e){console.error("加载数据失败:",e),u.index.showToast({title:"加载数据失败",icon:"error"})}finally{c.value=!1}}),q=e=>{v.value=e,"notes"===e&&j.bookId&&I()},w=e=>l(this,null,function*(){g.value=e,j.bookId=e.id,m.value=!1,"notes"===v.value&&(yield I())}),I=()=>l(this,null,function*(){if(j.bookId)try{f.value=[{id:1,title:"第一章重点",content:"这是第一章的重点内容摘录...",bookId:j.bookId,createdAt:"2024-01-15T10:30:00Z"}]}catch(e){console.error("加载笔记失败:",e)}}),C=()=>l(this,null,function*(){if(y.value)try{p.value=!0;const e=((e,l)=>{for(var u in l||(l={}))t.call(l,u)&&r(e,u,l[u]);if(o)for(var u of o(l))n.call(l,u)&&r(e,u,l[u]);return e})({title:j.title.trim(),bookId:j.bookId,description:j.description.trim()||void 0,type:v.value},"notes"===v.value&&{sourceNoteIds:h.value});console.debug("[createMindmap] 待提交数据",e),u.index.showToast({title:"创建成功",icon:"success"}),setTimeout(()=>{u.index.navigateBack()},1500)}catch(e){console.error("创建思维导图失败:",e),u.index.showToast({title:"创建失败",icon:"error"})}finally{p.value=!1}else u.index.showToast({title:"请填写完整信息",icon:"error"})}),T=()=>{j.bookId?u.index.navigateTo({url:`/pages-note/add/add?bookId=${j.bookId}`}):u.index.showToast({title:"请先选择书籍",icon:"none"})},z=()=>{m.value=!1,u.index.navigateTo({url:"/pages/index/index"})};return(e,o)=>u.e({a:u.o(C),b:u.p({text:"保存",size:"mini",type:"primary",loading:p.value}),c:u.p({title:"创建思维导图",showBack:!0}),d:u.o(e=>j.title=e),e:u.p({placeholder:"请输入思维导图标题",border:!1,modelValue:j.title}),f:u.p({label:"思维导图标题",prop:"title",required:!0}),g:u.o(e=>m.value=!0),h:u.p({text:g.value?g.value.title:"请选择书籍",size:"large",type:g.value?"info":"default",plain:!0}),i:u.p({label:"选择书籍",prop:"bookId",required:!0}),j:u.o(e=>j.description=e),k:u.p({placeholder:"请输入备注信息（可选）",height:"80",border:!1,modelValue:j.description}),l:u.p({label:"备注",prop:"description"}),m:u.sr("formRef","340aa05c-3,340aa05c-2"),n:u.p({model:j,rules:k}),o:u.p({name:"file",size:"32",color:"blank"===v.value?"#059669":"#666"}),p:"blank"===v.value?1:"",q:u.o(e=>q("blank")),r:u.p({name:"list",size:"32",color:"notes"===v.value?"#059669":"#666"}),s:"notes"===v.value?1:"",t:u.o(e=>q("notes")),v:"notes"===v.value},"notes"===v.value?u.e({w:0===f.value.length},0===f.value.length?{x:u.o(T),y:u.p({icon:"list",title:"该书籍暂无笔记",actionText:"去添加笔记"})}:{z:u.f(f.value,(e,o,t)=>{return{a:"340aa05c-13-"+t+",340aa05c-2",b:u.p({name:h.value.includes(e.id)?"checkbox-mark":"checkbox",size:"20",color:h.value.includes(e.id)?"#059669":"#ccc"}),c:u.t(e.title||"无标题"),d:u.t(e.content),e:u.t((n=e.createdAt,new Date(n).toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"}))),f:e.id,g:h.value.includes(e.id)?1:"",h:u.o(o=>(e=>{const o=h.value.indexOf(e);o>-1?h.value.splice(o,1):h.value.push(e)})(e.id),e.id)};var n})}):{},{A:0===b.value.length},0===b.value.length?{B:u.o(z),C:u.p({icon:"book",title:"暂无书籍",actionText:"去添加书籍"})}:{D:u.f(b.value,(e,o,t)=>({a:u.t(e.title),b:u.t(e.author||"未知作者"),c:e.id,d:u.o(o=>w(e),e.id)}))},{E:u.o(e=>m.value=e),F:u.p({mode:"bottom",height:"60%",round:"20",closeable:!0,modelValue:m.value}),G:u.p({loading:c.value,"bg-color":"#f5f7fa"})})}}),v=u._export_sfc(m,[["__scopeId","data-v-340aa05c"]]);wx.createPage(v);
