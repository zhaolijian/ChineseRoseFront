"use strict";var e=(e,o,t)=>new Promise((n,l)=>{var a=e=>{try{r(t.next(e))}catch(o){l(o)}},i=e=>{try{r(t.throw(e))}catch(o){l(o)}},r=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,i);r((t=t.apply(e,o)).next())});const o=require("../../common/vendor.js");if(!Array){(o.resolveComponent("u-icon")+o.resolveComponent("u-button")+o.resolveComponent("u-empty")+o.resolveComponent("u-image")+o.resolveComponent("u-popup")+o.resolveComponent("u-loading-page"))()}const t=o.defineComponent({__name:"view",setup(t){const n=o.ref([]),l=o.ref(null),a=o.ref(!1),i=o.ref(!1),r=o.ref({});o.onLoad(e=>{e.bookId&&(r.value.bookId=parseInt(e.bookId))}),o.onMounted(()=>e(this,null,function*(){yield u()})),o.onShow(()=>e(this,null,function*(){yield u()}));const u=()=>e(this,null,function*(){try{a.value=!0,r.value.bookId?yield d(r.value.bookId):yield s()}catch(e){console.error("加载思维导图失败:",e),o.index.showToast({title:"加载失败",icon:"error"})}finally{a.value=!1}}),s=()=>e(this,null,function*(){n.value=[]}),d=o=>e(this,null,function*(){l.value=null}),c=()=>{o.index.showToast({title:"功能开发中",icon:"none"})},v=()=>{r.value.bookId&&o.index.showToast({title:"功能开发中",icon:"none"})},p=()=>{l.value&&o.index.showToast({title:"功能开发中",icon:"none"})},m=()=>{l.value&&o.index.showToast({title:"功能开发中",icon:"none"})},h=()=>{l.value&&o.index.showToast({title:"功能开发中",icon:"none"}),i.value=!1},f=()=>{l.value&&o.index.showToast({title:"功能开发中",icon:"none"}),i.value=!1},x=()=>{l.value&&o.index.showModal({title:"确认删除",content:"删除后不可恢复，确定要删除这个思维导图吗？",success:t=>e(this,null,function*(){if(t.confirm&&l.value)try{l.value=null,o.index.showToast({title:"删除成功",icon:"success"}),yield u()}catch(e){console.error("删除思维导图失败:",e),o.index.showToast({title:"删除失败",icon:"error"})}})}),i.value=!1},w=()=>{l.value&&r.value.bookId?l.value=null:o.index.navigateBack()},b=e=>{if(!e)return"";const o=new Date(e),t=(new Date).getTime()-o.getTime(),n=Math.floor(t/864e5);return 0===n?"今天":1===n?"昨天":n<7?`${n}天前`:o.toLocaleDateString()};return(e,t)=>o.e({a:o.p({name:"arrow-left",size:"20",color:"#333"}),b:o.o(w),c:o.o(e=>i.value=!0),d:o.p({name:"more-dot-fill",size:"20",color:"#333"}),e:!r.value.bookId},r.value.bookId?o.e({m:!l.value},l.value?{q:o.t(l.value.title),r:o.o(p),s:o.p({name:"edit-pen",size:"18",color:"#00a82d"}),t:o.o(m),v:o.p({name:"download",size:"18",color:"#00a82d"})}:{n:o.o(v),o:o.p({type:"primary",text:"为这本书创建思维导图"}),p:o.p({mode:"data",text:"该书籍还没有思维导图",textColor:"#999",iconSize:"80"})}):o.e({f:o.o(c),g:o.p({text:"新建",size:"small",type:"primary"}),h:0===n.value.length},0===n.value.length?{i:o.o(c),j:o.p({type:"primary",text:"创建第一个思维导图"}),k:o.p({mode:"data",text:"还没有思维导图",textColor:"#999",iconSize:"80"})}:{l:o.f(n.value,(e,t,n)=>o.e({a:"8f431e80-5-"+n,b:o.p({src:e.thumbnail||"/static/images/mindmap-placeholder.png",width:"100%",height:"120px",mode:"aspectFill",radius:"8"}),c:o.t(e.title),d:e.bookTitle},e.bookTitle?{e:o.t(e.bookTitle)}:{},{f:o.t(b(e.updatedAt)),g:e.id,h:o.o(o=>(e=>{l.value=e})(e),e.id)}))}),{w:o.p({name:"share",size:"20",color:"#00a82d"}),x:o.o(h),y:o.p({name:"download",size:"20",color:"#00a82d"}),z:o.o(f),A:o.p({name:"trash",size:"20",color:"#ff6b6b"}),B:o.o(x),C:o.o(e=>i.value=e),D:o.p({mode:"bottom",height:"200px",round:"20",closeable:!0,modelValue:i.value}),E:o.p({loading:a.value,"bg-color":"#f5f7fa"})})}}),n=o._export_sfc(t,[["__scopeId","data-v-8f431e80"]]);wx.createPage(n);
