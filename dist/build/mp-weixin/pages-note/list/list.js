"use strict";var e=(e,l,o)=>new Promise((t,a)=>{var n=e=>{try{u(o.next(e))}catch(l){a(l)}},i=e=>{try{u(o.throw(e))}catch(l){a(l)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);u((o=o.apply(e,l)).next())});const l=require("../../common/vendor.js");if(!Array){(l.resolveComponent("u-icon")+l.resolveComponent("u-search")+l.resolveComponent("u-button")+l.resolveComponent("u-empty")+l.resolveComponent("u-popup")+l.resolveComponent("u-loading-page"))()}const o=l.defineComponent({__name:"list",setup(o){const t=l.ref([]),a=l.ref(""),n=l.ref("all"),i=l.ref("createdAt_desc"),u=l.ref(!1),r=l.ref(!1),s=l.ref(!0),d=l.ref(1),c=l.ref(20),v=l.ref(!1),f=l.ref(!1),h=l.ref(null),p=[{key:"all",label:"全部"},{key:"reading",label:"阅读笔记"},{key:"thought",label:"思考感悟"},{key:"quote",label:"摘录"},{key:"summary",label:"总结"}],g=[{key:"createdAt_desc",label:"创建时间（新到旧）"},{key:"createdAt_asc",label:"创建时间（旧到新）"},{key:"updatedAt_desc",label:"更新时间（新到旧）"},{key:"title_asc",label:"标题（A到Z）"}],m=l.ref({});l.onLoad(e=>{e.bookId&&(m.value.bookId=parseInt(e.bookId))}),l.onMounted(()=>e(this,null,function*(){yield y(!0)})),l.onShow(()=>e(this,null,function*(){yield y(!0)})),l.onPullDownRefresh(()=>e(this,null,function*(){yield y(!0),l.index.stopPullDownRefresh()})),l.onReachBottom(()=>e(this,null,function*(){s.value&&!u.value&&(yield b())}));const y=(o=!1)=>e(this,null,function*(){try{u.value=!0,o&&(r.value=!0,d.value=1);const e=[];o?t.value=e:t.value.push(...e),s.value=e.length===c.value,o||d.value++}catch(e){console.error("加载笔记失败:",e),l.index.showToast({title:"加载失败",icon:"error"})}finally{u.value=!1,r.value=!1}}),b=()=>e(this,null,function*(){s.value&&(d.value++,yield y())}),k=l=>e(this,null,function*(){a.value=l,yield y(!0)}),x=()=>e(this,null,function*(){a.value="",yield y(!0)}),w=l=>e(this,null,function*(){n.value=l,yield y(!0)}),T=l=>e(this,null,function*(){i.value=l,v.value=!1,yield y(!0)}),_=()=>{const e=m.value.bookId?`/pages-note/add/add?bookId=${m.value.bookId}`:"/pages-note/add/add";l.index.navigateTo({url:e})},z=()=>{h.value&&l.index.navigateTo({url:`/pages-note/edit/edit?id=${h.value.id}`}),f.value=!1},I=()=>{h.value&&l.index.showToast({title:"功能开发中",icon:"none"}),f.value=!1},A=()=>{h.value&&l.index.showModal({title:"确认删除",content:"删除后不可恢复，确定要删除这条笔记吗？",success:o=>e(this,null,function*(){if(o.confirm&&h.value)try{const e=t.value.findIndex(e=>e.id===h.value.id);-1!==e&&t.value.splice(e,1),l.index.showToast({title:"删除成功",icon:"success"})}catch(e){console.error("删除笔记失败:",e),l.index.showToast({title:"删除失败",icon:"error"})}})}),f.value=!1},C=e=>{if(!e)return"";const l=new Date(e),o=(new Date).getTime()-l.getTime(),t=Math.floor(o/6e4),a=Math.floor(o/36e5),n=Math.floor(o/864e5);return t<60?`${t}分钟前`:a<24?`${a}小时前`:n<7?`${n}天前`:l.toLocaleDateString()};return(e,o)=>l.e({a:l.p({name:"search",size:"18",color:"#999"}),b:l.o(k),c:l.o(x),d:l.o(e=>a.value=e),e:l.p({placeholder:"搜索笔记...","bg-color":"#f8f9fa","border-color":"transparent",modelValue:a.value}),f:l.f(p,(e,o,t)=>({a:l.t(e.label),b:e.key,c:n.value===e.key?1:"",d:l.o(l=>w(e.key),e.key)})),g:l.p({name:"list",size:"16",color:"#666"}),h:l.o(e=>v.value=!0),i:0===t.value.length&&!u.value},0!==t.value.length||u.value?{m:l.f(t.value,(e,o,t)=>{return l.e({a:l.t(e.title),b:e.bookTitle},e.bookTitle?{c:l.t(e.bookTitle)}:{},{d:l.t(C(e.createdAt)),e:l.t(e.content),f:e.tags&&e.tags.length>0},e.tags&&e.tags.length>0?l.e({g:l.f(e.tags.slice(0,3),(e,o,t)=>({a:l.t(e),b:e})),h:e.tags.length>3},(e.tags.length,{})):{},{i:e.images&&e.images.length>0},e.images&&e.images.length>0?{j:"96a32610-5-"+t,k:l.p({name:"image",size:"14",color:"#999"})}:{},{l:l.t((a=e.noteType,{reading:"阅读",thought:"思考",quote:"摘录",summary:"总结"}[a]||"笔记")),m:e.id,n:l.o(o=>(e=>{l.index.navigateTo({url:`/pages-note/edit/edit?id=${e.id}`})})(e),e.id),o:l.o(l=>(e=>{h.value=e,f.value=!0})(e),e.id)});var a})}:{j:l.o(_),k:l.p({type:"primary",text:"添加第一条笔记"}),l:l.p({mode:"list",text:"还没有笔记",textColor:"#999",iconSize:"80"})},{n:l.p({name:"plus",size:"24",color:"#fff"}),o:l.o(_),p:l.f(g,(e,o,t)=>l.e({a:l.t(e.label),b:i.value===e.key},i.value===e.key?{c:"96a32610-8-"+t+",96a32610-7",d:l.p({name:"checkmark",size:"16",color:"#00a82d"})}:{},{e:e.key,f:i.value===e.key?1:"",g:l.o(l=>T(e.key),e.key)})),q:l.o(e=>v.value=e),r:l.p({mode:"bottom",height:"300px",round:"20",closeable:!0,modelValue:v.value}),s:l.p({name:"edit-pen",size:"20",color:"#00a82d"}),t:l.o(z),v:l.p({name:"share",size:"20",color:"#00a82d"}),w:l.o(I),x:l.p({name:"trash",size:"20",color:"#ff6b6b"}),y:l.o(A),z:l.o(e=>f.value=e),A:l.p({mode:"bottom",height:"200px",round:"20",closeable:!0,modelValue:f.value}),B:l.p({loading:r.value,"bg-color":"#f5f7fa"})})}}),t=l._export_sfc(o,[["__scopeId","data-v-96a32610"]]);wx.createPage(t);
