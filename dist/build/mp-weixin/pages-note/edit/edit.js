"use strict";var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,o,a)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,i=(e,t,o)=>new Promise((a,n)=>{var r=e=>{try{i(o.next(e))}catch(t){n(t)}},l=e=>{try{i(o.throw(e))}catch(t){n(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,l);i((o=o.apply(e,t)).next())});const s=require("../../common/vendor.js");if(!Array){(s.resolveComponent("u-icon")+s.resolveComponent("u-image")+s.resolveComponent("u-button")+s.resolveComponent("u-input")+s.resolveComponent("u-textarea")+s.resolveComponent("u-loading-page"))()}Math||(c+u+p)();const c=()=>"../../components/common/AppNavBar.js",p=()=>"../../components/common/PageContainer.js",u=()=>"../../components/common/PrimaryButton.js",m=s.defineComponent({__name:"edit",setup(e){const c=s.reactive({title:"",content:"",noteType:"reading",tags:[],images:[]}),p=s.reactive({title:"",content:"",noteType:"reading",pageNumber:"",chapterName:"",tags:[],images:[]}),u=s.ref(!1),m=s.ref(!1),g=s.ref(""),d=s.ref(0),b=[{key:"reading",label:"阅读",icon:"book"},{key:"thought",label:"思考",icon:"heart"},{key:"quote",label:"摘录",icon:"quote-left"},{key:"summary",label:"总结",icon:"list"}],h=s.computed(()=>p.title.trim()&&p.content.trim());s.onLoad(e=>{e.id&&(d.value=parseInt(e.id))}),s.onMounted(()=>i(this,null,function*(){d.value&&(yield f())}));const f=()=>i(this,null,function*(){try{m.value=!0;const e={id:d.value,title:"示例笔记标题",content:"这是一条示例笔记内容，展示笔记的详细信息和编辑功能。",bookTitle:"示例书籍",noteType:"reading",pageNumber:"123",chapterName:"第一章",tags:["重要","学习"],images:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};Object.assign(c,e)}catch(e){console.error("加载笔记详情失败:",e),s.index.showToast({title:"加载失败",icon:"error"})}finally{m.value=!1}}),v=()=>{var e,i,s;Object.assign(p,(i=((e,t)=>{for(var o in t||(t={}))n.call(t,o)&&l(e,o,t[o]);if(a)for(var o of a(t))r.call(t,o)&&l(e,o,t[o]);return e})({},c),s={pageNumber:(null==(e=c.pageNumber)?void 0:e.toString())||"",chapterName:c.chapterName||""},t(i,o(s)))),u.value=!0},y=()=>i(this,null,function*(){if(h.value)try{m.value=!0,Object.assign(c,p),u.value=!1,s.index.showToast({title:"保存成功",icon:"success"})}catch(e){console.error("保存笔记失败:",e),s.index.showToast({title:"保存失败",icon:"error"})}finally{m.value=!1}else s.index.showToast({title:"请填写完整信息",icon:"error"})}),x=()=>{s.index.showModal({title:"确认删除",content:"删除后不可恢复，确定要删除这条笔记吗？",success:e=>i(this,null,function*(){if(e.confirm)try{m.value=!0,s.index.showToast({title:"删除成功",icon:"success"}),setTimeout(()=>{s.index.navigateBack()},1500)}catch(t){console.error("删除笔记失败:",t),s.index.showToast({title:"删除失败",icon:"error"})}finally{m.value=!1}})})},w=()=>{s.index.showToast({title:"功能开发中",icon:"none"})},T=()=>{const e=g.value.trim();e&&!p.tags.includes(e)&&p.tags.length<5&&(p.tags.push(e),g.value="")},N=()=>{s.index.chooseImage({count:9-p.images.length,sizeType:["compressed"],sourceType:["camera","album"],success:e=>{p.images.push(...e.tempFilePaths)}})},k=()=>{u.value?s.index.showModal({title:"确认退出",content:"当前有未保存的更改，确定要退出吗？",success:e=>{e.confirm&&(u.value=!1)}}):s.index.navigateBack()},O=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日`};return(e,t)=>{return s.e({a:u.value},u.value?{b:s.unref(h)?"":1,c:s.o(y)}:{d:s.o(v),e:s.p({name:"edit-pen",size:"20"})},{f:s.o(k),g:s.p({title:u.value?"编辑笔记":"笔记详情"}),h:!u.value},u.value?s.e({D:s.o(e=>p.title=e),E:s.p({placeholder:"请输入笔记标题",border:!1,maxlength:"100",modelValue:p.title}),F:s.f(b,(e,t,o)=>({a:s.n(p.noteType===e.key?"cr-icon--active":"cr-icon"),b:"fee8fbb3-8-"+o+",fee8fbb3-2",c:s.p({name:e.icon,size:"16"}),d:s.t(e.label),e:e.key,f:p.noteType===e.key?1:"",g:s.o(t=>p.noteType=e.key,e.key)})),G:s.o(e=>p.pageNumber=e),H:s.p({placeholder:"页码",type:"number",border:!1,modelValue:p.pageNumber}),I:s.o(e=>p.chapterName=e),J:s.p({placeholder:"章节",border:!1,modelValue:p.chapterName}),K:s.o(e=>p.content=e),L:s.p({placeholder:"请输入笔记内容...",border:!1,"auto-height":!0,maxlength:"5000","show-word-limit":!0,modelValue:p.content}),M:p.images.length>0},p.images.length>0?{N:s.f(p.images,(e,t,o)=>({a:"fee8fbb3-12-"+o+",fee8fbb3-2",b:s.p({src:e,width:"80px",height:"80px",radius:"8",mode:"aspectFill"}),c:"fee8fbb3-13-"+o+",fee8fbb3-2",d:s.o(e=>(e=>{p.images.splice(e,1)})(t),t),e:t})),O:s.p({name:"close",size:"12",color:"#fff"})}:{},{P:s.o(N),Q:s.p({text:"添加图片",size:"small"}),R:p.tags.length>0},p.tags.length>0?{S:s.f(p.tags,(e,t,o)=>({a:s.t(e),b:s.o(e=>(e=>{p.tags.splice(e,1)})(t),t),c:"fee8fbb3-15-"+o+",fee8fbb3-2",d:t})),T:s.p({name:"close",size:"12",color:"#999"})}:{},{U:s.o(T),V:s.o(e=>g.value=e),W:s.p({placeholder:"添加标签...",border:!1,modelValue:g.value}),X:s.o(T),Y:s.p({text:"添加",size:"small",type:"primary",disabled:!g.value.trim()})}):s.e({i:s.t(c.title),j:c.bookTitle},c.bookTitle?{k:s.t(c.bookTitle)}:{},{l:c.pageNumber},c.pageNumber?{m:s.t(c.pageNumber)}:{},{n:c.chapterName},c.chapterName?{o:s.t(c.chapterName)}:{},{p:s.t((o=c.noteType,{reading:"阅读笔记",thought:"思考感悟",quote:"摘录",summary:"总结"}[o||""]||"笔记")),q:s.t(O(c.updatedAt)),r:s.t(c.content),s:c.images&&c.images.length>0},c.images&&c.images.length>0?{t:s.f(c.images,(e,t,o)=>({a:"fee8fbb3-3-"+o+",fee8fbb3-2",b:s.p({src:e,mode:"aspectFill",width:"100%",height:"120px",radius:"8"}),c:t,d:s.o(e=>(e=>{s.index.previewImage({urls:c.images,current:e})})(t),t)}))}:{},{v:c.tags&&c.tags.length>0},c.tags&&c.tags.length>0?{w:s.f(c.tags,(e,t,o)=>({a:s.t(e),b:e}))}:{},{x:s.o(v),y:s.p({size:"md"}),z:s.o(w),A:s.p({text:"分享"}),B:s.o(x),C:s.p({text:"删除",type:"error"})}),{Z:s.p({loading:m.value,"bg-color":"rgba(255,255,255,0.8)"})});var o}}}),g=s._export_sfc(m,[["__scopeId","data-v-fee8fbb3"]]);wx.createPage(g);
