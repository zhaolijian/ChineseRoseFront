"use strict";var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,o,a)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,i=(e,t,o)=>new Promise((a,n)=>{var r=e=>{try{i(o.next(e))}catch(t){n(t)}},l=e=>{try{i(o.throw(e))}catch(t){n(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,l);i((o=o.apply(e,t)).next())});const s=require("../../common/vendor.js");if(!Array){(s.resolveComponent("u-icon")+s.resolveComponent("u-image")+s.resolveComponent("u-button")+s.resolveComponent("u-input")+s.resolveComponent("u-textarea")+s.resolveComponent("u-loading-page"))()}Math||((()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+c+(()=>"../../node-modules/uview-plus/components/u-image/u-image.js")+p+(()=>"../../node-modules/uview-plus/components/u-button/u-button.js")+(()=>"../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../node-modules/uview-plus/components/u-textarea/u-textarea.js")+u+(()=>"../../node-modules/uview-plus/components/u-loading-page/u-loading-page.js"))();const c=()=>"../../components/common/AppNavBar.js",u=()=>"../../components/common/PageContainer.js",p=()=>"../../components/common/PrimaryButton.js",m=s.defineComponent({__name:"edit",setup(e){const c=s.reactive({title:"",content:"",noteType:"reading",tags:[],images:[]}),u=s.reactive({title:"",content:"",noteType:"reading",pageNumber:"",chapterName:"",tags:[],images:[]}),p=s.ref(!1),m=s.ref(!1),d=s.ref(""),g=s.ref(0),h=[{key:"reading",label:"阅读",icon:"book"},{key:"thought",label:"思考",icon:"heart"},{key:"quote",label:"摘录",icon:"quote-left"},{key:"summary",label:"总结",icon:"list"}],v=s.computed(()=>u.title.trim()&&u.content.trim());s.onLoad(e=>{e.id&&(g.value=parseInt(e.id))}),s.onMounted(()=>i(this,null,function*(){g.value&&(yield b())}));const b=()=>i(this,null,function*(){try{m.value=!0;const e={id:g.value,title:"示例笔记标题",content:"这是一条示例笔记内容，展示笔记的详细信息和编辑功能。",bookTitle:"示例书籍",noteType:"reading",pageNumber:"123",chapterName:"第一章",tags:["重要","学习"],images:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};Object.assign(c,e)}catch(e){console.error("加载笔记详情失败:",e),s.index.showToast({title:"加载失败",icon:"error"})}finally{m.value=!1}}),f=()=>{var e,i,s;Object.assign(u,(i=((e,t)=>{for(var o in t||(t={}))n.call(t,o)&&l(e,o,t[o]);if(a)for(var o of a(t))r.call(t,o)&&l(e,o,t[o]);return e})({},c),s={pageNumber:(null==(e=c.pageNumber)?void 0:e.toString())||"",chapterName:c.chapterName||""},t(i,o(s)))),p.value=!0},y=()=>i(this,null,function*(){if(v.value)try{m.value=!0,Object.assign(c,u),p.value=!1,s.index.showToast({title:"保存成功",icon:"success"})}catch(e){console.error("保存笔记失败:",e),s.index.showToast({title:"保存失败",icon:"error"})}finally{m.value=!1}else s.index.showToast({title:"请填写完整信息",icon:"error"})}),w=()=>{s.index.showModal({title:"确认删除",content:"删除后不可恢复，确定要删除这条笔记吗？",success:e=>i(this,null,function*(){if(e.confirm)try{m.value=!0,s.index.showToast({title:"删除成功",icon:"success"}),setTimeout(()=>{s.index.navigateBack()},1500)}catch(t){console.error("删除笔记失败:",t),s.index.showToast({title:"删除失败",icon:"error"})}finally{m.value=!1}})})},x=()=>{s.index.showToast({title:"功能开发中",icon:"none"})},T=()=>{const e=d.value.trim();e&&!u.tags.includes(e)&&u.tags.length<5&&(u.tags.push(e),d.value="")},j=()=>{s.index.chooseImage({count:9-u.images.length,sizeType:["compressed"],sourceType:["camera","album"],success:e=>{u.images.push(...e.tempFilePaths)}})},N=()=>{p.value?s.index.showModal({title:"确认退出",content:"当前有未保存的更改，确定要退出吗？",success:e=>{e.confirm&&(p.value=!1)}}):s.index.navigateBack()},k=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日`};return(e,t)=>{return s.e({a:p.value},p.value?{b:s.unref(v)?"":1,c:s.o(y)}:{d:s.o(f),e:s.p({name:"edit-pen",size:"20"})},{f:s.o(N),g:s.p({title:p.value?"编辑笔记":"笔记详情"}),h:!p.value},p.value?s.e({D:s.o(e=>u.title=e),E:s.p({placeholder:"请输入笔记标题",border:!1,maxlength:"100",modelValue:u.title}),F:s.f(h,(e,t,o)=>({a:s.n(u.noteType===e.key?"cr-icon--active":"cr-icon"),b:"466c9df2-8-"+o+",466c9df2-2",c:s.p({name:e.icon,size:"16"}),d:s.t(e.label),e:e.key,f:u.noteType===e.key?1:"",g:s.o(t=>u.noteType=e.key,e.key)})),G:s.o(e=>u.pageNumber=e),H:s.p({placeholder:"页码",type:"number",border:!1,modelValue:u.pageNumber}),I:s.o(e=>u.chapterName=e),J:s.p({placeholder:"章节",border:!1,modelValue:u.chapterName}),K:s.o(e=>u.content=e),L:s.p({placeholder:"请输入笔记内容...",border:!1,"auto-height":!0,maxlength:"5000","show-word-limit":!0,modelValue:u.content}),M:u.images.length>0},u.images.length>0?{N:s.f(u.images,(e,t,o)=>({a:"466c9df2-12-"+o+",466c9df2-2",b:s.p({src:e,width:"80px",height:"80px",radius:"8",mode:"aspectFill"}),c:"466c9df2-13-"+o+",466c9df2-2",d:s.o(e=>(e=>{u.images.splice(e,1)})(t),t),e:t})),O:s.p({name:"close",size:"12",color:"#fff"})}:{},{P:s.o(j),Q:s.p({text:"添加图片",size:"small"}),R:u.tags.length>0},u.tags.length>0?{S:s.f(u.tags,(e,t,o)=>({a:s.t(e),b:s.o(e=>(e=>{u.tags.splice(e,1)})(t),t),c:"466c9df2-15-"+o+",466c9df2-2",d:t})),T:s.p({name:"close",size:"12",color:"#999"})}:{},{U:s.o(T),V:s.o(e=>d.value=e),W:s.p({placeholder:"添加标签...",border:!1,modelValue:d.value}),X:s.o(T),Y:s.p({text:"添加",size:"small",type:"primary",disabled:!d.value.trim()})}):s.e({i:s.t(c.title),j:c.bookTitle},c.bookTitle?{k:s.t(c.bookTitle)}:{},{l:c.pageNumber},c.pageNumber?{m:s.t(c.pageNumber)}:{},{n:c.chapterName},c.chapterName?{o:s.t(c.chapterName)}:{},{p:s.t((o=c.noteType,{reading:"阅读笔记",thought:"思考感悟",quote:"摘录",summary:"总结"}[o||""]||"笔记")),q:s.t(k(c.updatedAt)),r:s.t(c.content),s:c.images&&c.images.length>0},c.images&&c.images.length>0?{t:s.f(c.images,(e,t,o)=>({a:"466c9df2-3-"+o+",466c9df2-2",b:s.p({src:e,mode:"aspectFill",width:"100%",height:"120px",radius:"8"}),c:t,d:s.o(e=>(e=>{s.index.previewImage({urls:c.images,current:e})})(t),t)}))}:{},{v:c.tags&&c.tags.length>0},c.tags&&c.tags.length>0?{w:s.f(c.tags,(e,t,o)=>({a:s.t(e),b:e}))}:{},{x:s.o(f),y:s.p({size:"md"}),z:s.o(x),A:s.p({text:"分享"}),B:s.o(w),C:s.p({text:"删除",type:"error"})}),{Z:s.p({loading:m.value,"bg-color":"rgba(255,255,255,0.8)"})});var o}}}),d=s._export_sfc(m,[["__scopeId","data-v-466c9df2"]]);wx.createPage(d);
