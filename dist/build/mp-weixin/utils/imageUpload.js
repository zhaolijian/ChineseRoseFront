"use strict";const e=require("../common/vendor.js"),r=require("../api/modules/storage.js");exports.presignAndUploadCover=t=>{return o=exports,s=null,a=function*(){const o=t.split("/").pop()||"cover.jpg",s=o.toLowerCase().endsWith(".png")?"image/png":"image/jpeg",a=yield r.getCoverPresign({filename:o,contentType:s}),{uploadUrl:n,headers:i,key:l,previewUrl:d}=a,u=yield(p=t,new Promise((r,t)=>{try{return void e.wx$1.getFileSystemManager().readFile({filePath:p,success:e=>r(e.data),fail:t})}catch(o){return void t(o)}t(new Error("当前平台不支持读取本地文件为二进制"))}));var p;return yield((r,t,o)=>new Promise((s,a)=>{e.wx$1.request({url:r,method:"PUT",header:t,data:o,success:e=>e.statusCode<300?s():a(new Error("COS上传失败: "+e.statusCode)),fail:a})}))(n,i,u),{key:l,previewUrl:d}},new Promise((e,r)=>{var t=e=>{try{i(a.next(e))}catch(t){r(t)}},n=e=>{try{i(a.throw(e))}catch(t){r(t)}},i=r=>r.done?e(r.value):Promise.resolve(r.value).then(t,n);i((a=a.apply(o,s)).next())});var o,s,a};
