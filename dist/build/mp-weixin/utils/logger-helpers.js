"use strict";const t=require("../common/vendor.js"),e=require("../stores/modules/user.js");function n(){var n,r;try{const u="function"==typeof t.getActivePinia?t.getActivePinia():null,l="function"==typeof getApp&&(null==(n=getApp())?void 0:n.$pinia)||null,i=u||l;let s=null;if(i)s=e.useUserStore(i);else try{s=e.useUserStore()}catch(o){s=null}if(null==(r=null==s?void 0:s.userInfo)?void 0:r.id)return function(e){try{if(!e)return"";const n=t.CryptoJS.MD5(e).toString();return n.substring(0,8)+n.substring(n.length-8)}catch(n){return console.warn("[Logger] 哈希用户ID失败:",n),""}}(s.userInfo.id)}catch(u){}return""}function r(){let e="",r="unknown";e=n();try{r=t.index.getSystemInfoSync().platform||"unknown"}catch(o){console.warn("[Logger] 获取平台信息失败:",o)}return{traceId:Date.now().toString()+Math.random().toString(36).substring(2,6),userId:e,timestamp:Date.now(),platform:r}}let o=null,u=null;exports.clearRequestContext=function(){o=null,u&&(clearTimeout(u),u=null)},exports.createContext=r,exports.createRequestContext=function(){return o||(o=r(),u&&clearTimeout(u),u=setTimeout(()=>{o=null,u=null},5e3),o)};
