"use strict";var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,n=(t,o,l)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l,a=(e,t)=>{for(var o in t||(t={}))r.call(t,o)&&n(e,o,t[o]);if(l)for(var o of l(t))u.call(t,o)&&n(e,o,t[o]);return e},i=(e,t)=>{var o={};for(var n in e)r.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&l)for(var n of l(e))t.indexOf(n)<0&&u.call(e,n)&&(o[n]=e[n]);return o},s=(e,t,o)=>new Promise((l,r)=>{var u=e=>{try{a(o.next(e))}catch(t){r(t)}},n=e=>{try{a(o.throw(e))}catch(t){r(t)}},a=e=>e.done?l(e.value):Promise.resolve(e.value).then(u,n);a((o=o.apply(e,t)).next())});const c=require("../../common/vendor.js"),v=require("../../utils/request.js"),d=c.defineStore("book",()=>{const e=c.ref([]),l=c.ref(null),r=c.ref(!1),u=c.ref(1),n=c.ref(20),d=c.ref(0),f=c.ref(!0),p=c.computed(()=>e.value.length),h=c.computed(()=>e.value.filter(e=>"reading"===e.status)),y=c.computed(()=>e.value.filter(e=>"finished"===e.status)),g=c.computed(()=>e.value.filter(e=>"wishlist"===e.status)),k=(...l)=>s(exports,[...l],function*(l=1,s={}){var c,p,h,y,g,k,b;try{r.value=!0;const m=s,{pageSize:w}=m,x=i(m,["pageSize"]),B=null!=(c=null!=w?w:x.limit)?c:n.value,P=a({page:l,limit:B},x),O=yield v.request({url:"/v1/books",method:"GET",data:P});if(O){const r=O,i=r.books||[];1===l?e.value=[...i]:e.value.push(...i);const{pagination:s}=r;u.value=null!=(p=null==s?void 0:s.page)?p:l,n.value=null!=(h=null==s?void 0:s.limit)?h:B,d.value=null!=(y=null==s?void 0:s.total)?y:i.length,f.value=s?s.page<s.totalPages:i.length>=(null!=(g=null==s?void 0:s.limit)?g:B);return k=a({},r),b={books:i,pagination:null!=s?s:{page:u.value,limit:n.value,total:d.value,totalPages:f.value?u.value+1:u.value},hasMore:f.value},t(k,o(b))}}catch(m){throw console.error("获取书籍列表失败:",m),m}finally{r.value=!1}}),b=t=>s(exports,null,function*(){var o;try{const r=t,{id:u}=r,n=i(r,["id"]),a=yield v.request({url:`/v1/books/${u}`,method:"PUT",data:n});if(a){const t=a,r=e.value.findIndex(e=>e.id===u);return-1!==r&&(e.value[r]=t),(null==(o=l.value)?void 0:o.id)===u&&(l.value=t),t}throw new Error("更新书籍失败")}catch(r){throw console.error("更新书籍失败:",r),r}});return{books:e,currentBook:l,loading:r,currentPage:u,pageSize:n,total:d,hasMore:f,bookCount:p,readingBooks:h,finishedBooks:y,wishlistBooks:g,fetchBooks:k,fetchBookDetail:t=>s(exports,null,function*(){try{const o=yield v.request({url:`/v1/books/${t}`,method:"GET"});if(o){l.value=o;const r=e.value.findIndex(e=>e.id===t);return-1!==r&&(e.value[r]=o),o}throw new Error("获取书籍详情失败")}catch(o){throw console.error("获取书籍详情失败:",o),o}}),createBook:t=>s(exports,null,function*(){try{const o=yield v.request({url:"/v1/books",method:"POST",data:t});if(o){const t=o;return e.value.unshift(t),d.value++,t}throw new Error("创建书籍失败")}catch(o){throw console.error("创建书籍失败:",o),o}}),updateBook:b,deleteBook:t=>s(exports,null,function*(){var o;try{if(void 0!==(yield v.request({url:`/v1/books/${t}`,method:"DELETE"}))){const r=e.value.findIndex(e=>e.id===t);-1!==r&&(e.value.splice(r,1),d.value--),(null==(o=l.value)?void 0:o.id)===t&&(l.value=null)}}catch(r){throw console.error("删除书籍失败:",r),r}}),searchBooks:(e,t=1)=>s(exports,null,function*(){return yield k(t,{keyword:e,page:t,limit:n.value})}),filterBooksByStatus:(e,t=1)=>s(exports,null,function*(){return yield k(t,{status:e,page:t,limit:n.value})}),fetchBookByISBN:e=>s(exports,null,function*(){try{return(yield v.request({url:"/v1/books/isbn",method:"GET",params:{isbn:e}}))||null}catch(t){return console.error("通过ISBN获取书籍信息失败:",t),null}}),updateReadingProgress:(e,t)=>s(exports,null,function*(){return yield b({id:e,progress:t})}),updateReadingStatus:(e,t)=>s(exports,null,function*(){return yield b({id:e,status:t})}),batchDeleteBooks:t=>s(exports,null,function*(){try{void 0!==(yield v.request({url:"/v1/books/batch-delete",method:"POST",data:{ids:t}}))&&(e.value=e.value.filter(e=>!t.includes(e.id)),d.value-=t.length)}catch(o){throw console.error("批量删除书籍失败:",o),o}}),resetState:()=>{e.value=[],l.value=null,r.value=!1,u.value=1,d.value=0,f.value=!0},setCurrentBook:e=>{l.value=e}}});exports.useBookStore=d;
