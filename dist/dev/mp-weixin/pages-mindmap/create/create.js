"use strict";var e=Object.defineProperty,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(o,t,r)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,l=(e,o,t)=>new Promise((r,n)=>{var l=e=>{try{i(t.next(e))}catch(o){n(o)}},s=e=>{try{i(t.throw(e))}catch(o){n(o)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(l,s);i((t=t.apply(e,o)).next())});const s=require("../../common/vendor.js"),i=require("../../stores/modules/book.js"),u=require("../../stores/modules/note.js"),a=require("../../stores/modules/mindmap.js");if(require("../../utils/request.js"),require("../../utils/logger.js"),require("../../utils/logger-helpers.js"),require("../../stores/modules/user.js"),require("../../utils/storage.js"),require("../../constants/storage.js"),require("../../utils/base64.js"),require("../../api/modules/auth.js"),require("../../types/errorCodes.js"),require("../../constants/request.js"),require("../../utils/error-handler.js"),require("../../api/modules/note.js"),require("../../api/modules/mindmap.js"),!Array){(s.resolveComponent("u-button")+s.resolveComponent("u-input")+s.resolveComponent("u-form-item")+s.resolveComponent("u-textarea")+s.resolveComponent("u-form")+s.resolveComponent("u-icon")+s.resolveComponent("u-popup")+s.resolveComponent("u-loading-page"))()}Math||((()=>"../../node-modules/uview-plus/components/u-button/u-button.js")+d+(()=>"../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../node-modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../../node-modules/uview-plus/components/u-textarea/u-textarea.js")+(()=>"../../node-modules/uview-plus/components/u-form/u-form.js")+(()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+p+c+(()=>"../../node-modules/uview-plus/components/u-popup/u-popup.js")+(()=>"../../node-modules/uview-plus/components/u-loading-page/u-loading-page.js"))();const d=()=>"../../components/common/AppNavBar.js",c=()=>"../../components/common/PageContainer.js",p=()=>"../../components/common/EmptyState.js",m=s.defineComponent({__name:"create",setup(e){const d=i.useBookStore();u.useNoteStore(),a.useMindmapStore();const c=s.ref(!1),p=s.ref(!1),m=s.ref(!1),v=s.ref("blank"),f=s.ref([]),b=s.ref([]),h=s.ref([]),g=s.ref(null),j=s.reactive({title:"",bookId:null,description:""}),k={title:[{required:!0,message:"请输入思维导图标题",trigger:"blur"}],bookId:[{required:!0,message:"请选择书籍",trigger:"change"}]},y=s.computed(()=>"blank"===v.value?j.title.trim()&&j.bookId:j.title.trim()&&j.bookId&&h.value.length>0);s.onMounted(()=>l(this,null,function*(){yield x()}));const x=()=>l(this,null,function*(){try{c.value=!0;const e=yield d.fetchBooks(1);f.value=e.books||[]}catch(e){console.error("加载数据失败:",e),s.index.showToast({title:"加载数据失败",icon:"error"})}finally{c.value=!1}}),q=e=>{v.value=e,"notes"===e&&j.bookId&&I()},w=e=>l(this,null,function*(){g.value=e,j.bookId=e.id,m.value=!1,"notes"===v.value&&(yield I())}),I=()=>l(this,null,function*(){if(j.bookId)try{b.value=[{id:1,title:"第一章重点",content:"这是第一章的重点内容摘录...",bookId:j.bookId,createdAt:"2024-01-15T10:30:00Z"}]}catch(e){console.error("加载笔记失败:",e)}}),C=()=>l(this,null,function*(){if(y.value)try{p.value=!0;const e=((e,l)=>{for(var s in l||(l={}))t.call(l,s)&&n(e,s,l[s]);if(o)for(var s of o(l))r.call(l,s)&&n(e,s,l[s]);return e})({title:j.title.trim(),bookId:j.bookId,description:j.description.trim()||void 0,type:v.value},"notes"===v.value&&{sourceNoteIds:h.value});console.debug("[createMindmap] 待提交数据",e),s.index.showToast({title:"创建成功",icon:"success"}),setTimeout(()=>{s.index.navigateBack()},1500)}catch(e){console.error("创建思维导图失败:",e),s.index.showToast({title:"创建失败",icon:"error"})}finally{p.value=!1}else s.index.showToast({title:"请填写完整信息",icon:"error"})}),T=()=>{j.bookId?s.index.navigateTo({url:`/pages-note/add/add?bookId=${j.bookId}`}):s.index.showToast({title:"请先选择书籍",icon:"none"})},z=()=>{m.value=!1,s.index.navigateTo({url:"/pages/index/index"})};return(e,o)=>s.e({a:s.o(C),b:s.p({text:"保存",size:"mini",type:"primary",loading:p.value}),c:s.p({title:"创建思维导图",showBack:!0}),d:s.o(e=>j.title=e),e:s.p({placeholder:"请输入思维导图标题",border:!1,modelValue:j.title}),f:s.p({label:"思维导图标题",prop:"title",required:!0}),g:s.o(e=>m.value=!0),h:s.p({text:g.value?g.value.title:"请选择书籍",size:"large",type:g.value?"info":"default",plain:!0}),i:s.p({label:"选择书籍",prop:"bookId",required:!0}),j:s.o(e=>j.description=e),k:s.p({placeholder:"请输入备注信息（可选）",height:"80",border:!1,modelValue:j.description}),l:s.p({label:"备注",prop:"description"}),m:s.sr("formRef","0ff58511-3,0ff58511-2"),n:s.p({model:j,rules:k}),o:s.p({name:"file",size:"32",color:"blank"===v.value?"#059669":"#666"}),p:"blank"===v.value?1:"",q:s.o(e=>q("blank")),r:s.p({name:"list",size:"32",color:"notes"===v.value?"#059669":"#666"}),s:"notes"===v.value?1:"",t:s.o(e=>q("notes")),v:"notes"===v.value},"notes"===v.value?s.e({w:0===b.value.length},0===b.value.length?{x:s.o(T),y:s.p({icon:"list",title:"该书籍暂无笔记",actionText:"去添加笔记"})}:{z:s.f(b.value,(e,o,t)=>{return{a:"0ff58511-13-"+t+",0ff58511-2",b:s.p({name:h.value.includes(e.id)?"checkbox-mark":"checkbox",size:"20",color:h.value.includes(e.id)?"#059669":"#ccc"}),c:s.t(e.title||"无标题"),d:s.t(e.content),e:s.t((r=e.createdAt,new Date(r).toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"}))),f:e.id,g:h.value.includes(e.id)?1:"",h:s.o(o=>(e=>{const o=h.value.indexOf(e);o>-1?h.value.splice(o,1):h.value.push(e)})(e.id),e.id)};var r})}):{},{A:0===f.value.length},0===f.value.length?{B:s.o(z),C:s.p({icon:"book",title:"暂无书籍",actionText:"去添加书籍"})}:{D:s.f(f.value,(e,o,t)=>({a:s.t(e.title),b:s.t(e.author||"未知作者"),c:e.id,d:s.o(o=>w(e),e.id)}))},{E:s.o(e=>m.value=e),F:s.p({mode:"bottom",height:"60%",round:"20",closeable:!0,modelValue:m.value}),G:s.p({loading:c.value,"bg-color":"#f5f7fa"})})}}),v=s._export_sfc(m,[["__scopeId","data-v-0ff58511"],["__file","/Users/zhaolijian/Projects/chinese-rose-front/src/pages-mindmap/create/create.vue"]]);wx.createPage(v);
