"use strict";var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,o,a)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,s=(e,t,o)=>new Promise((a,n)=>{var r=e=>{try{s(o.next(e))}catch(t){n(t)}},i=e=>{try{s(o.throw(e))}catch(t){n(t)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,i);s((o=o.apply(e,t)).next())});const l=require("../../common/vendor.js");if(!Array){(l.resolveComponent("u-icon")+l.resolveComponent("u-image")+l.resolveComponent("u-button")+l.resolveComponent("u-input")+l.resolveComponent("u-textarea")+l.resolveComponent("u-loading-page"))()}Math||((()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+c+(()=>"../../node-modules/uview-plus/components/u-image/u-image.js")+p+(()=>"../../node-modules/uview-plus/components/u-button/u-button.js")+(()=>"../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../node-modules/uview-plus/components/u-textarea/u-textarea.js")+u+(()=>"../../node-modules/uview-plus/components/u-loading-page/u-loading-page.js"))();const c=()=>"../../components/common/AppNavBar.js",u=()=>"../../components/common/PageContainer.js",p=()=>"../../components/common/PrimaryButton.js",m=l.defineComponent({__name:"edit",setup(e){const c=l.reactive({title:"",content:"",noteType:"reading",tags:[],images:[]}),u=l.reactive({title:"",content:"",noteType:"reading",pageNumber:"",chapterName:"",tags:[],images:[]}),p=l.ref(!1),m=l.ref(!1),g=l.ref(""),d=l.ref(0),h=[{key:"reading",label:"阅读",icon:"book"},{key:"thought",label:"思考",icon:"heart"},{key:"quote",label:"摘录",icon:"quote-left"},{key:"summary",label:"总结",icon:"list"}],b=l.computed(()=>u.title.trim()&&u.content.trim());l.onLoad(e=>{e.id&&(d.value=parseInt(e.id))}),l.onMounted(()=>s(this,null,function*(){d.value&&(yield v())}));const v=()=>s(this,null,function*(){try{m.value=!0;const e={id:d.value,title:"示例笔记标题",content:"这是一条示例笔记内容，展示笔记的详细信息和编辑功能。",bookTitle:"示例书籍",noteType:"reading",pageNumber:"123",chapterName:"第一章",tags:["重要","学习"],images:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};Object.assign(c,e)}catch(e){console.error("加载笔记详情失败:",e),l.index.showToast({title:"加载失败",icon:"error"})}finally{m.value=!1}}),f=()=>{var e,s,l;Object.assign(u,(s=((e,t)=>{for(var o in t||(t={}))n.call(t,o)&&i(e,o,t[o]);if(a)for(var o of a(t))r.call(t,o)&&i(e,o,t[o]);return e})({},c),l={pageNumber:(null==(e=c.pageNumber)?void 0:e.toString())||"",chapterName:c.chapterName||""},t(s,o(l)))),p.value=!0},y=()=>s(this,null,function*(){if(b.value)try{m.value=!0,Object.assign(c,u),p.value=!1,l.index.showToast({title:"保存成功",icon:"success"})}catch(e){console.error("保存笔记失败:",e),l.index.showToast({title:"保存失败",icon:"error"})}finally{m.value=!1}else l.index.showToast({title:"请填写完整信息",icon:"error"})}),w=()=>{l.index.showModal({title:"确认删除",content:"删除后不可恢复，确定要删除这条笔记吗？",success:e=>s(this,null,function*(){if(e.confirm)try{m.value=!0,l.index.showToast({title:"删除成功",icon:"success"}),setTimeout(()=>{l.index.navigateBack()},1500)}catch(t){console.error("删除笔记失败:",t),l.index.showToast({title:"删除失败",icon:"error"})}finally{m.value=!1}})})},x=()=>{l.index.showToast({title:"功能开发中",icon:"none"})},j=()=>{const e=g.value.trim();e&&!u.tags.includes(e)&&u.tags.length<5&&(u.tags.push(e),g.value="")},T=()=>{l.index.chooseImage({count:9-u.images.length,sizeType:["compressed"],sourceType:["camera","album"],success:e=>{u.images.push(...e.tempFilePaths)}})},N=()=>{p.value?l.index.showModal({title:"确认退出",content:"当前有未保存的更改，确定要退出吗？",success:e=>{e.confirm&&(p.value=!1)}}):l.index.navigateBack()},k=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日`};return(e,t)=>{return l.e({a:p.value},p.value?{b:l.unref(b)?"":1,c:l.o(y)}:{d:l.o(f),e:l.p({name:"edit-pen",size:"20"})},{f:l.o(N),g:l.p({title:p.value?"编辑笔记":"笔记详情"}),h:!p.value},p.value?l.e({D:l.o(e=>u.title=e),E:l.p({placeholder:"请输入笔记标题",border:!1,maxlength:"100",modelValue:u.title}),F:l.f(h,(e,t,o)=>({a:l.n(u.noteType===e.key?"cr-icon--active":"cr-icon"),b:"e784b0f4-8-"+o+",e784b0f4-2",c:l.p({name:e.icon,size:"16"}),d:l.t(e.label),e:e.key,f:u.noteType===e.key?1:"",g:l.o(t=>u.noteType=e.key,e.key)})),G:l.o(e=>u.pageNumber=e),H:l.p({placeholder:"页码",type:"number",border:!1,modelValue:u.pageNumber}),I:l.o(e=>u.chapterName=e),J:l.p({placeholder:"章节",border:!1,modelValue:u.chapterName}),K:l.o(e=>u.content=e),L:l.p({placeholder:"请输入笔记内容...",border:!1,"auto-height":!0,maxlength:"5000","show-word-limit":!0,modelValue:u.content}),M:u.images.length>0},u.images.length>0?{N:l.f(u.images,(e,t,o)=>({a:"e784b0f4-12-"+o+",e784b0f4-2",b:l.p({src:e,width:"80px",height:"80px",radius:"8",mode:"aspectFill"}),c:"e784b0f4-13-"+o+",e784b0f4-2",d:l.o(e=>(e=>{u.images.splice(e,1)})(t),t),e:t})),O:l.p({name:"close",size:"12",color:"#fff"})}:{},{P:l.o(T),Q:l.p({text:"添加图片",size:"small"}),R:u.tags.length>0},u.tags.length>0?{S:l.f(u.tags,(e,t,o)=>({a:l.t(e),b:l.o(e=>(e=>{u.tags.splice(e,1)})(t),t),c:"e784b0f4-15-"+o+",e784b0f4-2",d:t})),T:l.p({name:"close",size:"12",color:"#999"})}:{},{U:l.o(j),V:l.o(e=>g.value=e),W:l.p({placeholder:"添加标签...",border:!1,modelValue:g.value}),X:l.o(j),Y:l.p({text:"添加",size:"small",type:"primary",disabled:!g.value.trim()})}):l.e({i:l.t(c.title),j:c.bookTitle},c.bookTitle?{k:l.t(c.bookTitle)}:{},{l:c.pageNumber},c.pageNumber?{m:l.t(c.pageNumber)}:{},{n:c.chapterName},c.chapterName?{o:l.t(c.chapterName)}:{},{p:l.t((o=c.noteType,{reading:"阅读笔记",thought:"思考感悟",quote:"摘录",summary:"总结"}[o||""]||"笔记")),q:l.t(k(c.updatedAt)),r:l.t(c.content),s:c.images&&c.images.length>0},c.images&&c.images.length>0?{t:l.f(c.images,(e,t,o)=>({a:"e784b0f4-3-"+o+",e784b0f4-2",b:l.p({src:e,mode:"aspectFill",width:"100%",height:"120px",radius:"8"}),c:t,d:l.o(e=>(e=>{l.index.previewImage({urls:c.images,current:e})})(t),t)}))}:{},{v:c.tags&&c.tags.length>0},c.tags&&c.tags.length>0?{w:l.f(c.tags,(e,t,o)=>({a:l.t(e),b:e}))}:{},{x:l.o(f),y:l.p({size:"md"}),z:l.o(x),A:l.p({text:"分享"}),B:l.o(w),C:l.p({text:"删除",type:"error"})}),{Z:l.p({loading:m.value,"bg-color":"rgba(255,255,255,0.8)"})});var o}}}),g=l._export_sfc(m,[["__scopeId","data-v-e784b0f4"],["__file","/Users/zhaolijian/Projects/chinese-rose-front/src/pages-note/edit/edit.vue"]]);wx.createPage(g);
