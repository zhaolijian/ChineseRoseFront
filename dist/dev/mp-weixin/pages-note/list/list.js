"use strict";var e=(e,o,l)=>new Promise((t,a)=>{var n=e=>{try{u(l.next(e))}catch(o){a(o)}},s=e=>{try{u(l.throw(e))}catch(o){a(o)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,s);u((l=l.apply(e,o)).next())});const o=require("../../common/vendor.js");require("../../utils/request.js");const l=require("../../utils/logger.js"),t=require("../../utils/logger-helpers.js");if(require("../../constants/request.js"),require("../../constants/storage.js"),require("../../utils/error-handler.js"),require("../../types/errorCodes.js"),require("../../stores/modules/user.js"),require("../../utils/storage.js"),require("../../utils/base64.js"),require("../../api/modules/auth.js"),!Array){(o.resolveComponent("u-icon")+o.resolveComponent("u-search")+o.resolveComponent("u-empty")+o.resolveComponent("u-popup")+o.resolveComponent("u-loading-page"))()}Math||((()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+(()=>"../../node-modules/uview-plus/components/u-search/u-search.js")+a+(()=>"../../node-modules/uview-plus/components/u-empty/u-empty.js")+(()=>"../../node-modules/uview-plus/components/u-popup/u-popup.js")+(()=>"../../node-modules/uview-plus/components/u-loading-page/u-loading-page.js"))();const a=()=>"../../components/common/PrimaryButton.js",n=o.defineComponent({__name:"list",setup(a){const n=o.ref([]),s=o.ref(""),u=o.ref("all"),r=o.ref("createdAt_desc"),i=o.ref(!1),d=o.ref(!1),c=o.ref(!0),p=o.ref(1),v=o.ref(20),f=o.ref(!1),g=o.ref(375),m=o.ref(56),h=e=>{const o=g.value||375;return Math.round(750*e/o)},y=o.computed(()=>({paddingTop:`${h(m.value)}rpx`})),b=o.computed(()=>({background:f.value?"#ffffff":"#f8f9fa",border:f.value?"2rpx solid #00a82d":"1rpx solid rgba(0, 0, 0, 0.12)",height:"72rpx",borderRadius:"40rpx",paddingLeft:f.value?"31rpx":"32rpx",paddingRight:f.value?"31rpx":"32rpx",transition:"all 0.2s ease"})),x={backgroundColor:"#ffffff",boxShadow:"0 -2rpx 16rpx rgba(0, 0, 0, 0.08)"},k=o.ref(!1),w=o.ref(!1),j=o.ref(null),q=[{key:"all",label:"全部"},{key:"reading",label:"阅读笔记"},{key:"thought",label:"思考感悟"},{key:"quote",label:"摘录"},{key:"summary",label:"总结"}],C=[{key:"createdAt_desc",label:"创建时间（新到旧）"},{key:"createdAt_asc",label:"创建时间（旧到新）"},{key:"updatedAt_desc",label:"更新时间（新到旧）"},{key:"title_asc",label:"标题（A到Z）"}],T=o.ref({});function z(){var e,a,n,s,u;try{const l=null==(a=(e=o.index).getSystemInfoSync)?void 0:a.call(e);if(!l)return;g.value=l.windowWidth||375;const t=l.statusBarHeight||0,r=null==(s=(n=o.index).getMenuButtonBoundingClientRect)?void 0:s.call(n),i=null!=(u=null==r?void 0:r.bottom)?u:t+44;m.value=i+6}catch(r){l.logger.warn(t.createContext(),"[NotesPage] 获取系统信息失败",r)}}o.onLoad(e=>{e.bookId&&(T.value.bookId=parseInt(e.bookId))}),o.onMounted(()=>e(this,null,function*(){const e=t.createContext();l.logger.info(e,"[NotesPage] 页面挂载"),z(),yield _(!0)})),o.onShow(()=>e(this,null,function*(){const e=t.createContext();l.logger.info(e,"[NotesPage] 页面显示"),z(),yield _(!0)})),o.onPullDownRefresh(()=>e(this,null,function*(){yield _(!0),o.index.stopPullDownRefresh()})),o.onReachBottom(()=>e(this,null,function*(){c.value&&!i.value&&(yield I())}));const _=(l=!1)=>e(this,null,function*(){try{i.value=!0,l&&(d.value=!0,p.value=1);const e=[];l?n.value=e:n.value.push(...e),c.value=e.length===v.value,l||p.value++}catch(e){console.error("加载笔记失败:",e),o.index.showToast({title:"加载失败",icon:"error"})}finally{i.value=!1,d.value=!1}}),I=()=>e(this,null,function*(){c.value&&(p.value++,yield _())}),P=o=>e(this,null,function*(){s.value=o,yield _(!0)}),A=()=>e(this,null,function*(){s.value="",yield _(!0)}),M=o=>e(this,null,function*(){u.value=o,yield _(!0)}),$=()=>{f.value=!0},B=()=>{f.value=!1},D=o=>e(this,null,function*(){r.value=o,k.value=!1,yield _(!0)}),R=()=>{const e=T.value.bookId?`/pages-note/add/add?bookId=${T.value.bookId}`:"/pages-note/add/add";o.index.navigateTo({url:e})},S=()=>{j.value&&o.index.navigateTo({url:`/pages-note/edit/edit?id=${j.value.id}`}),w.value=!1},L=()=>{j.value&&o.index.showToast({title:"功能开发中",icon:"none"}),w.value=!1},N=()=>{j.value&&o.index.showModal({title:"确认删除",content:"删除后不可恢复，确定要删除这条笔记吗？",success:l=>e(this,null,function*(){if(l.confirm&&j.value)try{const e=n.value.findIndex(e=>e.id===j.value.id);-1!==e&&n.value.splice(e,1),o.index.showToast({title:"删除成功",icon:"success"})}catch(e){console.error("删除笔记失败:",e),o.index.showToast({title:"删除失败",icon:"error"})}})}),w.value=!1},V=e=>{if(!e)return"";const o=new Date(e),l=(new Date).getTime()-o.getTime(),t=Math.floor(l/6e4),a=Math.floor(l/36e5),n=Math.floor(l/864e5);return t<60?`${t}分钟前`:a<24?`${a}小时前`:n<7?`${n}天前`:o.toLocaleDateString()};return(e,l)=>o.e({a:o.p({name:"search",size:"16",color:"#999"}),b:o.o(P),c:o.o(A),d:o.o($),e:o.o(B),f:o.o(e=>s.value=e),g:o.p({placeholder:"搜索笔记...","bg-color":"transparent",shape:"round","custom-style":o.unref(b),"placeholder-style":"color:#6b7280;font-size:28rpx;",modelValue:s.value}),h:o.s(o.unref(y)),i:o.f(q,(e,l,t)=>({a:o.t(e.label),b:e.key,c:u.value===e.key?1:"",d:o.o(o=>M(e.key),e.key)})),j:o.p({name:"list",size:"16",color:"#666"}),k:o.o(e=>k.value=!0),l:0===n.value.length&&!i.value},0!==n.value.length||i.value?{p:o.f(n.value,(e,l,t)=>{return o.e({a:o.t(e.title),b:e.bookTitle},e.bookTitle?{c:o.t(e.bookTitle)}:{},{d:o.t(V(e.createdAt)),e:o.t(e.excerpt||e.content),f:e.tags&&e.tags.length>0},e.tags&&e.tags.length>0?o.e({g:o.f(e.tags.slice(0,3),(e,l,t)=>({a:o.t(e),b:e})),h:e.tags.length>3},(e.tags.length,{})):{},{i:e.hasImages||e.images&&e.images.length>0},e.hasImages||e.images&&e.images.length>0?{j:"2dc5970b-5-"+t,k:o.p({name:"image",size:"14",color:"#999"})}:{},{l:o.t((a=e.noteType,{reading:"阅读",thought:"思考",quote:"摘录",summary:"总结"}[a]||"笔记")),m:e.id,n:o.o(l=>(e=>{o.index.navigateTo({url:`/pages-note/edit/edit?id=${e.id}`})})(e),e.id),o:o.o(o=>(e=>{j.value=e,w.value=!0})(e),e.id)});var a})}:{m:o.o(R),n:o.p({size:"md"}),o:o.p({mode:"list",text:"还没有笔记",textColor:"#999",iconSize:"80"})},{q:o.p({name:"plus",size:"24",color:"#fff"}),r:o.o(R),s:o.f(C,(e,l,t)=>o.e({a:o.t(e.label),b:r.value===e.key},r.value===e.key?{c:"2dc5970b-8-"+t+",2dc5970b-7",d:o.p({name:"checkmark",size:"16",color:"#00a82d"})}:{},{e:e.key,f:r.value===e.key?1:"",g:o.o(o=>D(e.key),e.key)})),t:o.o(e=>k.value=e),v:o.p({mode:"bottom",round:24,closeable:!0,"custom-style":x,modelValue:k.value}),w:o.p({name:"edit-pen",size:"20",color:"#00a82d"}),x:o.o(S),y:o.p({name:"share",size:"20",color:"#00a82d"}),z:o.o(L),A:o.p({name:"trash",size:"20",color:"#ff6b6b"}),B:o.o(N),C:o.o(e=>w.value=e),D:o.p({mode:"bottom",round:24,closeable:!0,"custom-style":x,modelValue:w.value}),E:o.p({loading:d.value,"bg-color":"#f5f7fa"})})}}),s=o._export_sfc(n,[["__scopeId","data-v-2dc5970b"],["__file","/Users/zhaolijian/Projects/chinese-rose-front/src/pages-note/list/list.vue"]]);wx.createPage(s);
