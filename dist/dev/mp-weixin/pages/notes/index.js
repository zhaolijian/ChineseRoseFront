"use strict";var e=(e,t,o)=>new Promise((n,a)=>{var r=e=>{try{s(o.next(e))}catch(t){a(t)}},l=e=>{try{s(o.throw(e))}catch(t){a(t)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,l);s((o=o.apply(e,t)).next())});const t=require("../../common/vendor.js"),o=require("../../stores/modules/note.js"),n=require("../../stores/modules/user.js"),a=require("../../utils/tabbar.js");require("../../utils/request.js");const r=require("../../utils/logger.js"),l=require("../../utils/logger-helpers.js");if(require("../../api/modules/note.js"),require("../../utils/storage.js"),require("../../constants/storage.js"),require("../../utils/base64.js"),require("../../api/modules/auth.js"),require("../../types/errorCodes.js"),require("../../constants/request.js"),require("../../utils/error-handler.js"),!Array){(t.resolveComponent("u-icon")+t.resolveComponent("u-tabs")+t.resolveComponent("u-loading-page"))()}Math||(s+g+u+i+c)();const s=()=>"../../components/common/AppNavBar.js",i=()=>"../../components/common/PageContainer.js",u=()=>"../../components/common/EmptyState.js",g=()=>"../../components/common/LoadingSkeleton.js",c=()=>"../../components/common/TabBar.js",d=t.defineComponent({__name:"index",setup(s){o.useNoteStore();const i=n.useUserStore(),u=t.ref([]),g=t.ref(!1),c=t.ref(!1),d=t.ref(!0),h=t.ref(0),m=t.ref([{name:"全部"},{name:"最近"},{name:"收藏"}]);t.onMounted(()=>e(this,null,function*(){const e=l.createContext();r.logger.info(e,"[NotesPage] 页面挂载"),yield v()})),t.onShow(()=>e(this,null,function*(){const e=l.createContext();r.logger.info(e,"[NotesPage] 页面显示"),a.safeHideTabBar(),yield p()})),t.onPullDownRefresh(()=>e(this,null,function*(){const e=l.createContext();r.logger.debug(e,"[NotesPage] 触发下拉刷新"),yield p(!0),t.index.stopPullDownRefresh()})),t.onReachBottom(()=>e(this,null,function*(){const e=l.createContext();d.value&&!g.value&&(r.logger.debug(e,"[NotesPage] 触底加载更多"),yield f())}));const v=()=>e(this,null,function*(){const e=l.createContext();try{if(c.value=!0,r.logger.debug(e,"[checkLoginAndLoadData] 开始检查登录状态"),!i.isLoggedIn)return r.logger.info(e,"[checkLoginAndLoadData] 用户未登录，跳转到登录页"),void t.index.navigateTo({url:"/pages/login/login"});r.logger.debug(e,"[checkLoginAndLoadData] 用户已登录，加载笔记数据"),yield p()}catch(o){r.logger.error(e,"[checkLoginAndLoadData] 初始化失败",o),t.index.showToast({title:"加载失败",icon:"error"})}finally{c.value=!1}}),p=(o=!1)=>e(this,null,function*(){const e=l.createContext();try{g.value=!0,r.logger.debug(e,"[loadNotes] 开始加载笔记",{refresh:o,filter:h.value});const t=[{id:1,title:"读书笔记示例",content:"这是一条示例笔记，展示笔记内容的格式。可以包含多行文本，支持各种格式的内容记录...",bookId:1,bookTitle:"《示例书籍》",tags:["重要","理论"],createdAt:"2024-01-15T10:30:00Z"}];o?u.value=t:u.value.push(...t),d.value=!1,r.logger.info(e,"[loadNotes] 加载笔记成功",{count:t.length})}catch(n){r.logger.error(e,"[loadNotes] 加载笔记失败",n),t.index.showToast({title:"加载失败",icon:"error"})}finally{g.value=!1}}),f=()=>e(this,null,function*(){d.value&&(yield p())}),b=e=>{const t=l.createContext();r.logger.debug(t,"[onFilterChange] 切换筛选",{filter:m.value[e].name}),h.value=e,p(!0)},x=()=>{const e=l.createContext();r.logger.debug(e,"[goToAddNote] 跳转到添加笔记页"),t.index.navigateTo({url:"/pages-note/add/add"})},j=()=>{const e=l.createContext();r.logger.debug(e,"[goToSearch] 跳转到搜索页",{type:"note"}),t.index.navigateTo({url:"/pages/search/search?type=note"})},y=e=>{const t=new Date(e),o=(new Date).getTime()-t.getTime(),n=Math.floor(o/864e5);return 0===n?"今天":1===n?"昨天":n<7?`${n}天前`:t.toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})};return(e,o)=>t.e({a:t.o(j),b:t.p({name:"search",size:"20"}),c:t.o(x),d:t.p({name:"plus-circle",size:"20"}),e:t.p({title:"笔记",showBack:!1}),f:t.o(b),g:t.o(e=>h.value=e),h:t.p({list:m.value,lineWidth:"30",lineHeight:"3",activeStyle:{color:"#059669",fontWeight:"bold"},modelValue:h.value}),i:g.value&&0===u.value.length},g.value&&0===u.value.length?{j:t.p({rows:4})}:0===u.value.length?{l:t.o(x),m:t.p({icon:"list",title:"还没有笔记",actionText:"添加第一条笔记"})}:{n:t.f(u.value,(e,o,n)=>t.e({a:t.t(e.title||"无标题"),b:t.t(y(e.createdAt)),c:t.t(e.content),d:"596485ab-7-"+n+",596485ab-4",e:t.t(e.bookTitle||"未知书籍"),f:e.tags&&e.tags.length},e.tags&&e.tags.length?{g:t.f(e.tags.slice(0,2),(e,o,n)=>({a:t.t(e),b:e||"t"+o}))}:{},{h:e.id||"note-"+o,i:t.o(o=>(e=>{const o=l.createContext();r.logger.debug(o,"[goToNoteDetail] 跳转到笔记详情",{noteId:e.id,title:e.title}),t.index.navigateTo({url:`/pages-note/detail/detail?id=${e.id}`})})(e),e.id||"note-"+o)})),o:t.p({name:"book",size:"12"})},{k:0===u.value.length,p:t.p({loading:c.value,"bg-color":"#f5f7fa"})})}}),h=t._export_sfc(d,[["__scopeId","data-v-596485ab"]]);wx.createPage(h);
