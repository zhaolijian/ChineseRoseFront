"use strict";var e=Object.defineProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(r,t,a)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,n=(e,n)=>{for(var o in n||(n={}))t.call(n,o)&&l(e,o,n[o]);if(r)for(var o of r(n))a.call(n,o)&&l(e,o,n[o]);return e},o=(e,r,t)=>new Promise((a,l)=>{var n=e=>{try{u(t.next(e))}catch(r){l(r)}},o=e=>{try{u(t.throw(e))}catch(r){l(r)}},u=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,o);u((t=t.apply(e,r)).next())});const u=require("../../common/vendor.js"),i=require("../../api/modules/mindmap.js");require("../../utils/request.js");const c=require("../../utils/logger.js"),d=require("../../utils/logger-helpers.js"),s=u.defineStore("mindmap",()=>{const e=u.ref([]),r=u.ref(null),t=u.ref(1),a=u.ref(20),l=u.ref(0),s=u.ref(!0),p=u.ref(!1),v=u.ref(""),g=u.ref([]),m=u.ref("idle"),f=u.ref(""),y=u.ref({}),M=(...r)=>o(exports,[...r],function*(r=1,o={}){const u=d.createContext();try{p.value=!0,y.value=n({},o);const d=yield i.getMindmaps(n({page:r,pageSize:a.value},o));return 1===r?e.value=[...d.list]:e.value.push(...d.list),t.value=d.page,l.value=d.total,s.value=d.hasMore,c.logger.debug(u,"[MindmapStore] 获取列表成功",{page:r,params:o,total:l.value}),d}catch(v){throw c.logger.error(u,"[MindmapStore] 获取列表失败",v),v}finally{p.value=!1}});return{mindmaps:e,currentMindmap:r,currentPage:t,pageSize:a,total:l,hasMore:s,loading:p,searchKeyword:v,searchResults:g,syncStatus:m,lastSyncTime:f,fetchMindmaps:M,fetchMindmapDetail:t=>o(exports,null,function*(){const a=d.createContext();try{p.value=!0;const l=yield i.getMindmapDetail(t);r.value=l;const n=e.value.findIndex(e=>e.id===t);return-1!==n&&(e.value[n]=l),c.logger.debug(a,"[MindmapStore] 获取详情成功",{id:t}),l}catch(l){throw c.logger.error(a,"[MindmapStore] 获取详情失败",l),l}finally{p.value=!1}}),createMindmap:r=>o(exports,null,function*(){const t=d.createContext();try{p.value=!0;const a=yield i.createMindmap(r);return e.value.unshift(a),l.value+=1,c.logger.info(t,"[MindmapStore] 创建思维导图成功",{id:a.id}),a}catch(a){throw c.logger.error(t,"[MindmapStore] 创建思维导图失败",a),a}finally{p.value=!1}}),updateMindmap:(t,a)=>o(exports,null,function*(){var l;const n=d.createContext();try{p.value=!0;const o=yield i.updateMindmap(t,a),u=e.value.findIndex(e=>e.id===t);return-1!==u&&(e.value[u]=o),(null==(l=r.value)?void 0:l.id)===t&&(r.value=o),c.logger.info(n,"[MindmapStore] 更新思维导图成功",{id:t}),o}catch(o){throw c.logger.error(n,"[MindmapStore] 更新思维导图失败",o),o}finally{p.value=!1}}),deleteMindmap:t=>o(exports,null,function*(){var a;const n=d.createContext();try{p.value=!0,yield i.deleteMindmap(t),e.value=e.value.filter(e=>e.id!==t),l.value=Math.max(0,l.value-1),(null==(a=r.value)?void 0:a.id)===t&&(r.value=null),c.logger.info(n,"[MindmapStore] 删除思维导图成功",{id:t})}catch(o){throw c.logger.error(n,"[MindmapStore] 删除思维导图失败",o),o}finally{p.value=!1}}),searchMindmaps:(e,...r)=>o(exports,[e,...r],function*(e,r={}){const t=d.createContext(),a=e.trim();if(v.value=a,!a)return g.value=[],c.logger.debug(t,"[MindmapStore] 搜索关键字为空，返回空结果"),[];try{p.value=!0;const e=yield i.searchMindmaps(a,r);return g.value=e.list,c.logger.debug(t,"[MindmapStore] 搜索成功",{keyword:a,count:e.list.length}),e.list}catch(l){throw c.logger.error(t,"[MindmapStore] 搜索失败",l),l}finally{p.value=!1}}),clearSearch:()=>{v.value="",g.value=[]},getUserMindmapCount:()=>o(exports,null,function*(){const e=d.createContext();try{const r=yield i.getMindmapStats();return c.logger.debug(e,"[MindmapStore] 获取统计成功",r),r.total}catch(r){return c.logger.error(e,"[MindmapStore] 获取统计失败",r),l.value}}),generateThumbnail:e=>o(exports,null,function*(){const r=d.createContext();try{const{url:t}=yield i.generateMindmapThumbnail(e);return c.logger.debug(r,"[MindmapStore] 生成缩略图成功",{id:e,url:t}),t}catch(t){throw c.logger.error(r,"[MindmapStore] 生成缩略图失败",t),t}}),syncMindmaps:()=>o(exports,null,function*(){const e=d.createContext();try{m.value="syncing",yield i.syncMindmaps(),yield M(1,y.value),f.value=(new Date).toISOString(),m.value="success",c.logger.info(e,"[MindmapStore] 同步成功")}catch(r){throw m.value="error",c.logger.error(e,"[MindmapStore] 同步失败",r),r}}),reset:()=>{e.value=[],r.value=null,t.value=1,l.value=0,s.value=!0,p.value=!1,v.value="",g.value=[],m.value="idle",y.value={}}}});exports.useMindmapStore=s;
